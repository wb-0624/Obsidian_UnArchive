# 注册中心

[注册中心最简单的作用](服务.md##使用Nacos)

把服务提供者要向外暴露的服务在注册中心进行注册，它记录了服务和服务地址的映射关系。之后消费者需要调用服务的时候，只需要服务名就可以进行调用，不需要使用冗长复杂的服务地址加端口。同时即便服务提供者的地址发生变化，也不需要去消费者中进行变动。使得服务之间调用的耦合度降低。

当然，在分布式系统中，我们不仅仅是需要在注册中心找到服务和服务地址的映射关系这么简单，我们还需要考虑更多更复杂的问题：

服务注册后，如何被及时发现

服务宕机后，如何及时下线

服务如何有效的水平扩展

服务发现时，如何进行路由

服务异常时，如何进行降级

注册中心如何实现自身的高可用

这里问题的解决都依赖于注册中心。简单看，注册中心的功能有点类似于DNS服务器或者负载均衡器，而实际上，注册中心作为微服务的基础组件，可能要更加复杂，也需要更多的灵活性和时效性。

# 配置中心

## 什么是配置

应用程序在启动和运行的时候往往需要读取一些配置信息，配置基本上伴随着应用程序的整个生命周期，比如：数据库连接参数、启动参数等。

配置主要有以下几个特点：

-   配置是独立于程序的只读变量

配置对于程序是只读的，程序通过读取配置来改变自己的行为，但是程序不应该去改变配置

-   配置伴随应用的整个生命周期

配置贯穿于应用的整个生命周期，应用在启动时通过读取配置来初始化，在运行时根据配置调整行为。如：启动时需要读取服务的端口号、系统在运行过程中需要读取定时策略执行定时任务等。

-   配置可以有多种加载方式

常见的有程序内部hard code，配置文件，环境变量，启动参数，基于数据库等

-   配置需要治理

同一份程序在不同的环境(开发、测试、生产)、不同的集群（如不同的数据中心）经常需有不同的配置，所以需要有完善的环境、集群配置管理

## 为什么需要配置中心

但是在微服务系统中，原本一个单体应用被拆分成若干个微服务。原本一个配置文件也就需要分散好几个，但是每个文件当中不免会有重复的部分。

![](./img/微服务中配置文件.png)

一个微服务当中的服务实例是不只一个的，它们除了运行端口等少部分配置不同之外，大部分的配置是相同的。相同的内容不仅占用了存储，同时需要修改配置信息的时候，又要对多个配置文件进行修改，就会显得异常繁琐。

同时一个应用在开发的过程中又需要，开发环境，测试环境等，不同的环境也需要不同的配置。

那么最好可以把配置文件统一管理，不同的部分再自己定义。通过设定程序去读取哪个配置文件来决定应用什么配置。

于是就有了配置中心。


选择Nacos的一个原因就是，Nacos既有注册中心的功能，同时也可以满足配置中心的功能。

[Nacos使用](Nacos使用.md)

